<section class="scroll-page">
  <script>
  //test function fired at the end of each audio
  function test(id) {
    console.log("test function called");
   alert("test function id is " + id);
}
  </script>
  <div class ="scene-title fade-in title">
    <div class ="scene-title-box">
      <h3>第二章</h3>
      <h1 class="scene-title-lgword">梁思成｜發現佛光寺</h1>
  </div>
  </div>
  <ul class="scroll-list fade-in content">
      <li class ="hori-scroll scene-sub-title fade-in">
          <div class="sub-title-line"></div>
           <h1>營造學社成立背景</h1>
      </li>
      <div class="scroll-each hori-scroll hideme">
          <audio controls id="audio_0" onended="playAudio(1)">
              <source ng-src="media/scene2/audio/001.mp3"></source>
          </audio>
          <div class="paragraph">
            <p> 佛光寺东大殿是我国古建筑类文化遗产最珍贵的一处，
              其自身的文物价值与其传奇的发现过程，对推动中国建筑
              史学的发展具有重大意义。中国建筑史学开端，发轫
        <br><b>于一本书：《营造法式》，<br>
          一个机构：中国营造学社，<br>一位学者：梁思成</b>。</p></div>
 </div>
    <li class="scroll-each hori-scroll hideme" ng-repeat-start="item in events" ng-click="selectItem(item)" ng-class="{activechap:item.selected}">
        <div class="left-chapscroll">
            <audio controls class="narration" id="audio_{{item.id}}" onended="playAudio(1)">
                <source ng-src="{{item.audio | trustUrl}}"></source>
            </audio>
            <h2 ng-if="$index == 0 || $index == 1|| $index == 2">{{item.title}}</h2>
            <h3>{{item.era}}</h3>
            <p>{{item.details | limitTo:letterLimit}} {{item.description.length > 80 ? '&hellip;': ''}}</p>
          </div>
<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
<!-- image carousel -->
             <!-- Indicators -->
             <ol class="carousel-indicators">
               <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                <li data-target="#carousel-example-generic" data-slide-to="1"></li>
                 <li data-target="#carousel-example-generic" data-slide-to="2" ></li>
             </ol>

             <!-- Wrapper for slides -->
             <div class="carousel-inner" role="listbox">
               <div class="item active" ng-repeat="img in item.images">
                 <img ng-src="dist/img/scene/{{img}}" alt="Photo of {{img}}">
                 <div class="carousel-caption">
                   {{img}}
                 </div>
               </div>
             </div>

             <!-- Controls -->
             <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
               <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
               <span class="sr-only"><</span>
             </a>
             <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
               <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
               <span class="sr-only">></span>
             </a>

    </div>
    </li>
    <li class ="hori-scroll scene-sub-title fade-in hideme" ng-if="$index == 5 || $index == 12|| $index == 13" ng-repeat-end>
         <div class="sub-title-line"></div>
         <h1>{{item.title}}</h1>
    </li>
    <a href ="#/tab/chap3">
    <div class="next-chap">
        <ul>
        <li><p>下一章</p>
        <h4>環繞東大殿</h4></li>
        <li><div class="arrow-right"></div></li>
    </ul>
</div></a>
<div id="bgm_section" ng-click="$index == 1">
    <audio id="bgm1" controls loop="">
        <source src="media/scene2/bgm/001.mp3" type="audio/mp3">
        <source src="media/scene2/bgm/001.ogg" type="audio/ogg">
        <source src="media/scene2/bgm/001.wav" type="audio/wav">
    </audio>
</div>
  </ul>
</section>
<script>
var count = 0;
var audios = new Array();
audios = document.getElementsByTagName('audio');

function playAudio(direction){
  console.log("play audio function called!");
  //this is the function that handles autoplay
  var nextAudio, currentAudio, previousAudio;

  currentAudio = document.getElementById('audio_' + count);

  if (count<16) {
    nextAudio = document.getElementById('audio_' + (count + 1));
  }
  if (count>0) {
    previousAudio = document.getElementById('audio_' + (count - 1));
  }

  if (direction>0) {
    for (var i = 0; i < audios.length; i++) {
      if (i != (count+1) && i!=16) {
        audios[i].pause();
      }
    }
    nextAudio.load();nextAudio.play();
  }else {
    for (var i = 0; i < audios.length; i++) {
      if (i != (count-1)&&i!=16) {
        audios[i].pause();
      }
    }
    previousAudio.load();previousAudio.play();
  }
  if (count < 15) {
    count++;
  }else {
    count = 0;
  }


}

</script>

  </div>
</div>
